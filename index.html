<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Gmail Sell App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        h1 {
            color: #333;
            font-size: 24px;
        }
        
        .admin-badge {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 12px 25px;
            background: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .stat-card h3 {
            color: #666;
            font-size: 14px;
            margin-bottom: 10px;
        }
        
        .stat-card .number {
            color: #333;
            font-size: 28px;
            font-weight: bold;
        }
        
        .filters {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .filter-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .filter-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .filter-btn.pending {
            background: #ffd700;
            color: #333;
        }
        
        .filter-btn.accepted {
            background: #4CAF50;
            color: white;
        }
        
        .filter-btn.rejected {
            background: #f44336;
            color: white;
        }
        
        .filter-btn.completed {
            background: #4CAF50;
            color: white;
        }
        
        .requests-grid, .withdrawals-grid, .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .user-email {
            color: #667eea;
            font-weight: 600;
            font-size: 14px;
            word-break: break-all;
        }
        
        .status {
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .status.pending {
            background: #fff3cd;
            color: #856404;
        }
        
        .status.accepted {
            background: #d4edda;
            color: #155724;
        }
        
        .status.rejected {
            background: #f8d7da;
            color: #721c24;
        }
        
        .status.completed {
            background: #d4edda;
            color: #155724;
        }
        
        .details {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
        }
        
        .details p {
            margin: 8px 0;
            color: #333;
        }
        
        .details strong {
            color: #667eea;
        }
        
        .actions {
            display: flex;
            gap: 10px;
        }
        
        .accept-btn, .reject-btn, .complete-btn {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .accept-btn, .complete-btn {
            background: #4CAF50;
            color: white;
        }
        
        .accept-btn:hover, .complete-btn:hover {
            background: #45a049;
        }
        
        .reject-btn {
            background: #f44336;
            color: white;
        }
        
        .reject-btn:hover {
            background: #da190b;
        }
        
        .reason-select {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .timestamp {
            color: #999;
            font-size: 12px;
            margin-top: 10px;
            text-align: right;
        }
        
        .balance {
            font-size: 20px;
            font-weight: bold;
            color: #4CAF50;
            margin: 10px 0;
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
        }
        
        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }
        
        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
        }
        
        .hidden {
            display: none;
        }
        
        .search-box {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Login Section -->
        <div id="loginSection" class="login-container">
            <h2>üîê Admin Login</h2>
            <p style="color: #666; margin-bottom: 20px;">Please login with your Google account</p>
            <button class="login-btn" onclick="loginWithGoogle()">Login with Google</button>
        </div>

        <!-- Admin Dashboard -->
        <div id="dashboardSection" class="hidden">
            <div class="header">
                <h1>üìä Admin Dashboard - Gmail Sell App</h1>
                <div>
                    <span class="admin-badge" id="adminEmail"></span>
                    <button class="logout-btn" onclick="logout()" style="margin-left: 10px;">Logout</button>
                </div>
            </div>

            <div class="stats">
                <div class="stat-card">
                    <h3>Total Users</h3>
                    <div class="number" id="totalUsers">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Sell Requests</h3>
                    <div class="number" id="totalRequests">0</div>
                </div>
                <div class="stat-card">
                    <h3>Pending Withdrawals</h3>
                    <div class="number" id="pendingWithdrawals">0</div>
                </div>
                <div class="stat-card">
                    <h3>Total Balance</h3>
                    <div class="number" id="totalBalance">$0</div>
                </div>
            </div>

            <div class="tabs">
                <button class="tab active" onclick="switchTab('sellRequests')">üìß Sell Requests</button>
                <button class="tab" onclick="switchTab('withdrawals')">üí∞ Withdrawals</button>
                <button class="tab" onclick="switchTab('users')">üë• Users</button>
            </div>

            <!-- Sell Requests Tab -->
            <div id="sellRequestsTab">
                <div class="filters">
                    <button class="filter-btn active" onclick="filterSellRequests('all')">All</button>
                    <button class="filter-btn pending" onclick="filterSellRequests('pending')">Pending</button>
                    <button class="filter-btn accepted" onclick="filterSellRequests('accepted')">Accepted</button>
                    <button class="filter-btn rejected" onclick="filterSellRequests('rejected')">Rejected</button>
                </div>
                <div id="sellRequestsContainer" class="requests-grid"></div>
            </div>

            <!-- Withdrawals Tab -->
            <div id="withdrawalsTab" class="hidden">
                <div class="filters">
                    <button class="filter-btn active" onclick="filterWithdrawals('all')">All</button>
                    <button class="filter-btn pending" onclick="filterWithdrawals('pending')">Pending</button>
                    <button class="filter-btn completed" onclick="filterWithdrawals('completed')">Completed</button>
                </div>
                <div id="withdrawalsContainer" class="withdrawals-grid"></div>
            </div>

            <!-- Users Tab -->
            <div id="usersTab" class="hidden">
                <input type="text" class="search-box" placeholder="Search users by email..." id="userSearch" onkeyup="searchUsers()">
                <div id="usersContainer" class="users-grid"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCF7UcnAVIZFX9bHydLsh7BX9OrqXq5nfA",
            authDomain: "sell-app-c066a.firebaseapp.com",
            projectId: "sell-app-c066a",
            storageBucket: "sell-app-c066a.firebasestorage.app",
            messagingSenderId: "69684837328",
            appId: "1:69684837328:web:05dedc991c1549417c57d5"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // Admin emails list - SIRF YAHI ADMIN LOGIN KAR PAYEGA
        const adminEmails = ['farhan661616@gmail.com'];

        // Current state
        let currentTab = 'sellRequests';
        let sellRequestsFilter = 'all';
        let withdrawalsFilter = 'all';
        let allUsers = [];

        // Check auth state
        auth.onAuthStateChanged((user) => {
            if (user && adminEmails.includes(user.email)) {
                document.getElementById('loginSection').classList.add('hidden');
                document.getElementById('dashboardSection').classList.remove('hidden');
                document.getElementById('adminEmail').textContent = user.email;
                loadAllData();
            } else {
                if (user) {
                    auth.signOut();
                }
                document.getElementById('loginSection').classList.remove('hidden');
                document.getElementById('dashboardSection').classList.add('hidden');
            }
        });

        // Login with Google
        function loginWithGoogle() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).catch(error => {
                alert('Login failed: ' + error.message);
            });
        }

        // Logout
        function logout() {
            auth.signOut();
        }

        // Switch tabs
        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('sellRequestsTab').classList.add('hidden');
            document.getElementById('withdrawalsTab').classList.add('hidden');
            document.getElementById('usersTab').classList.add('hidden');
            
            document.getElementById(tab + 'Tab').classList.remove('hidden');
            
            if (tab === 'users') {
                displayUsers(allUsers);
            }
        }

        // Load all data
        function loadAllData() {
            // Load users
            db.collection('users').onSnapshot((snapshot) => {
                allUsers = [];
                snapshot.forEach(doc => {
                    allUsers.push({ id: doc.id, ...doc.data() });
                });
                document.getElementById('totalUsers').textContent = allUsers.length;
                
                let totalBalance = 0;
                allUsers.forEach(user => {
                    totalBalance += user.balance || 0;
                });
                document.getElementById('totalBalance').textContent = '$' + totalBalance;
                
                if (currentTab === 'users') {
                    displayUsers(allUsers);
                }
            });

            // Load sell requests
            db.collection('sellRequests').orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
                const requests = [];
                snapshot.forEach(doc => {
                    requests.push({ id: doc.id, ...doc.data() });
                });
                document.getElementById('totalRequests').textContent = requests.length;
                if (currentTab === 'sellRequests') {
                    filterSellRequests(sellRequestsFilter);
                }
            });

            // Load withdrawals
            db.collection('withdrawals').orderBy('timestamp', 'desc').onSnapshot((snapshot) => {
                const withdrawals = [];
                snapshot.forEach(doc => {
                    withdrawals.push({ id: doc.id, ...doc.data() });
                });
                
                const pending = withdrawals.filter(w => w.status === 'pending').length;
                document.getElementById('pendingWithdrawals').textContent = pending;
                
                if (currentTab === 'withdrawals') {
                    filterWithdrawals(withdrawalsFilter);
                }
            });
        }

        // Filter sell requests
        function filterSellRequests(filter) {
            sellRequestsFilter = filter;
            document.querySelectorAll('#sellRequestsTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            db.collection('sellRequests').orderBy('timestamp', 'desc').get().then((snapshot) => {
                const requests = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (filter === 'all' || data.status === filter) {
                        requests.push({ id: doc.id, ...data });
                    }
                });
                displaySellRequests(requests);
            });
        }

        // Display sell requests
        function displaySellRequests(requests) {
            const container = document.getElementById('sellRequestsContainer');
            
            if (requests.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; background: white; border-radius: 10px;">No requests found</div>';
                return;
            }
            
            let html = '';
            requests.forEach(request => {
                html += `
                    <div class="card">
                        <div class="card-header">
                            <span class="user-email">${request.userEmail}</span>
                            <span class="status ${request.status}">${request.status}</span>
                        </div>
                        <div class="details">
                            <p><strong>Gmail:</strong> ${request.gmail}</p>
                            <p><strong>Password:</strong> ${request.password}</p>
                            ${request.reason ? `<p><strong>Reason:</strong> ${request.reason}</p>` : ''}
                        </div>
                        ${request.status === 'pending' ? `
                            <div class="actions">
                                <button class="accept-btn" onclick="acceptSellRequest('${request.id}', '${request.userId}', '${request.gmail}', '${request.password}')">Accept</button>
                                <button class="reject-btn" onclick="showRejectReason('${request.id}')">Reject</button>
                            </div>
                        ` : ''}
                        <div class="timestamp">${new Date(request.timestamp?.toDate()).toLocaleString()}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Accept sell request
        function acceptSellRequest(requestId, userId, gmail, password) {
            if (confirm('Accept this request? User will get $3')) {
                const batch = db.batch();
                
                // Update request status
                const requestRef = db.collection('sellRequests').doc(requestId);
                batch.update(requestRef, {
                    status: 'accepted',
                    acceptedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                
                // Update user balance
                const userRef = db.collection('users').doc(userId);
                batch.set(userRef, {
                    balance: firebase.firestore.FieldValue.increment(3),
                    lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                }, { merge: true });
                
                batch.commit().then(() => {
                    alert('Request accepted! User balance updated.');
                }).catch(error => {
                    alert('Error: ' + error.message);
                });
            }
        }

        // Show reject reason
        function showRejectReason(requestId) {
            const reason = prompt('Select reason:\n1. Temporary Mail\n2. Wrong Password\n3. Wrong Gmail\n4. 2 Step Verification\n\nEnter reason number or text:');
            
            if (reason) {
                let reasonText = reason;
                if (reason === '1') reasonText = 'Temporary Mail';
                else if (reason === '2') reasonText = 'Wrong Password';
                else if (reason === '3') reasonText = 'Wrong Gmail';
                else if (reason === '4') reasonText = '2 Step Verification';
                
                rejectSellRequest(requestId, reasonText);
            }
        }

        // Reject sell request
        function rejectSellRequest(requestId, reason) {
            db.collection('sellRequests').doc(requestId).update({
                status: 'rejected',
                reason: reason,
                rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
            }).then(() => {
                alert('Request rejected!');
            }).catch(error => {
                alert('Error: ' + error.message);
            });
        }

        // Filter withdrawals
        function filterWithdrawals(filter) {
            withdrawalsFilter = filter;
            document.querySelectorAll('#withdrawalsTab .filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            db.collection('withdrawals').orderBy('timestamp', 'desc').get().then((snapshot) => {
                const withdrawals = [];
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (filter === 'all' || data.status === filter) {
                        withdrawals.push({ id: doc.id, ...data });
                    }
                });
                displayWithdrawals(withdrawals);
            });
        }

        // Display withdrawals
        function displayWithdrawals(withdrawals) {
            const container = document.getElementById('withdrawalsContainer');
            
            if (withdrawals.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; background: white; border-radius: 10px;">No withdrawal requests found</div>';
                return;
            }
            
            let html = '';
            withdrawals.forEach(withdrawal => {
                html += `
                    <div class="card">
                        <div class="card-header">
                            <span class="user-email">${withdrawal.userEmail}</span>
                            <span class="status ${withdrawal.status}">${withdrawal.status}</span>
                        </div>
                        <div class="details">
                            <p><strong>Amount:</strong> $${withdrawal.amount}</p>
                            <p><strong>Bitcoin Address:</strong> ${withdrawal.bitcoinAddress}</p>
                            <p><strong>User Balance:</strong> $${withdrawal.userBalance}</p>
                        </div>
                        ${withdrawal.status === 'pending' ? `
                            <div class="actions">
                                <button class="complete-btn" onclick="completeWithdrawal('${withdrawal.id}', '${withdrawal.userId}', ${withdrawal.amount})">Mark Complete</button>
                            </div>
                        ` : ''}
                        <div class="timestamp">${new Date(withdrawal.timestamp?.toDate()).toLocaleString()}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Complete withdrawal
        function completeWithdrawal(withdrawalId, userId, amount) {
            if (confirm('Mark this withdrawal as completed?')) {
                db.collection('withdrawals').doc(withdrawalId).update({
                    status: 'completed',
                    completedAt: firebase.firestore.FieldValue.serverTimestamp()
                }).then(() => {
                    alert('Withdrawal marked as completed!');
                }).catch(error => {
                    alert('Error: ' + error.message);
                });
            }
        }

        // Display users
        function displayUsers(users) {
            const container = document.getElementById('usersContainer');
            
            if (users.length === 0) {
                container.innerHTML = '<div style="grid-column: 1/-1; text-align: center; padding: 50px; background: white; border-radius: 10px;">No users found</div>';
                return;
            }
            
            let html = '';
            users.forEach(user => {
                html += `
                    <div class="card">
                        <div class="card-header">
                            <span class="user-email">${user.email || 'N/A'}</span>
                        </div>
                        <div class="details">
                            <p><strong>User ID:</strong> ${user.id}</p>
                            <p><strong>Balance:</strong> $${user.balance || 0}</p>
                            <p><strong>Joined:</strong> ${user.createdAt ? new Date(user.createdAt.toDate()).toLocaleDateString() : 'N/A'}</p>
                        </div>
                        <div class="actions">
                            <button class="accept-btn" onclick="adjustBalance('${user.id}', '${user.email}')">Adjust Balance</button>
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }

        // Search users
        function searchUsers() {
            const searchTerm = document.getElementById('userSearch').value.toLowerCase();
            const filtered = allUsers.filter(user => 
                (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                (user.id && user.id.toLowerCase().includes(searchTerm))
            );
            displayUsers(filtered);
        }

        // Adjust user balance
        function adjustBalance(userId, userEmail) {
            const amount = prompt(`Enter amount to add/deduct for ${userEmail}:\n(Use negative for deduction, e.g., -5)`);
            
            if (amount !== null && !isNaN(amount)) {
                const numAmount = parseFloat(amount);
                if (confirm(`Update balance by $${numAmount}?`)) {
                    db.collection('users').doc(userId).update({
                        balance: firebase.firestore.FieldValue.increment(numAmount),
                        lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
                    }).then(() => {
                        alert('Balance updated!');
                    }).catch(error => {
                        alert('Error: ' + error.message);
                    });
                }
            }
        }
    </script>
</body>
</html>